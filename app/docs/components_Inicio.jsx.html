<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/Inicio.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/Inicio.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from "react";
import { Link, Redirect } from "react-router-dom";
import BarraNavegacion from "./BarraNavegacion";
import ListaHorizontal, { Menu } from "./ListaHorizontal";
import { Helmet } from "react-helmet";
import { isSignedIn, getUserID, getUserRole } from "../config/Auth";
import {
  getRecommendations,
  getVideosFromSubject,
  findTrendingVideos
} from "../config/VideoAPI";
import { getSubjectsOfUser } from "../config/UserAPI";
import { LoadingSpinUniCast } from "./LoadingSpin";

class Inicio extends Component {
  constructor() {
    super();
    this._isMounted = false;
    this.state = {
      contentMargin: "300px",
      displayAll: false,
      displayTrending: false,
      asignaturas: [],
      videosAsignatura: [[]],
      recomendados: [],
      trending: [],
      timeNow: new Date(),
      spinRecom: true,
      spinPopulares: true,
      spinAsignaturas: true
    };
    this.handleChange = this.handleChange.bind(this);
    this.getData = this.getData.bind(this);
  }
  /**
   * Obtiene las asignaturas del usuario y obtiene los videos de esas asignaturas.
   * Obtiene los videos recomendados para el usuario, y obtiene los videos que son tendencia.
   */
  getData() {
    getSubjectsOfUser(getUserID(), data => {
      data.map((asig, index) => {
        getVideosFromSubject(asig.id, 0, videos => {
          let newVideos = this.state.videosAsignatura.slice();
          newVideos[index] = videos;
          if (this._isMounted) {
            this.setState({ videosAsignatura: newVideos });
          }
        });
        return null;
      });
      if (this._isMounted) {
        this.setState({ asignaturas: data, spinAsignaturas: false });
      }
    });
    getRecommendations((data, now) => {
      if (this._isMounted) {
        this.setState({ recomendados: data, timeNow: now, spinRecom: false });
      }
    });
    findTrendingVideos(0, data => {
      if (this._isMounted) {
        this.setState({ trending: data, spinPopulares: false });
      }
    });
  }
  /**
   * Pone _isMounted a true. Si el usuario esta loggeado,
   * Obtiene las asignaturas del usuario y obtiene los videos de esas asignaturas.
   * Obtiene los videos recomendados para el usuario, y obtiene los videos que son tendencia.
   */
  componentWillMount() {
    this._isMounted = true;
    if (isSignedIn()) {
      this.getData();
    }
  }
  /**
   * Pone _isMounted a false.
   */
  componentWillUnmount() {
    this._isMounted = false;
  }

  /**
   * Aumenta o dimsinuye el margen izquierdo del contenido de la
   * página dependiendo del parámetro display
   * @param {Boolean} display Determina si aumentar o disminuir margen
   */
  handleChange(display) {
    if (display) {
      this.setState({ contentMargin: "300px" });
    } else {
      this.setState({ contentMargin: "71px" });
    }
  }

  render() {
    return !isSignedIn() || getUserRole() === "ROLE_ADMIN" ? (
      &lt;Redirect
        to={{
          pathname: "/",
          state: {
            url: `/inicio`
          }
        }}
      />
    ) : (
      &lt;div>
        &lt;Helmet>
          &lt;title>Inicio | UniCast&lt;/title>
          &lt;style>{"body { background-color: #fafafa; }"}&lt;/style>
        &lt;/Helmet>
        &lt;BarraNavegacion
          onChange={this.handleChange}
          activar={"inicio"}
          displaySide={true}
          hide={false}
        />
        &lt;div
          className="transform"
          style={{
            marginLeft: this.state.contentMargin,
            marginTop: "80px"
          }}
        >
          &lt;div>
            &lt;div style={{ display: "flex" }}>
              &lt;h5 style={{ fontWeight: "bold" }}>
                Vídeos populares de la última semana
              &lt;/h5>
              &lt;div
                className="boton-ver-todos-inicio"
                onClick={() =>
                  this.setState({
                    displayTrending: !this.state.displayTrending
                  })
                }
              >
                {this.state.displayTrending ? "Ver menos" : "Ver todos"}
              &lt;/div>
            &lt;/div>
            {!this.state.spinPopulares ? (
              this.state.displayTrending ? (
                &lt;div
                  style={{
                    display: "flex",
                    flexWrap: "wrap",
                    marginBottom: "50px",
                    borderBottom: "1px solid lightgrey",
                    overflow: "hidden",
                    width: "93.45%"
                  }}
                >
                  {Menu(this.state.trending, this.state.timeNow)}
                &lt;/div>
              ) : (
                &lt;ListaHorizontal
                  list={this.state.trending}
                  now={this.state.timeNow}
                />
              )
            ) : (
              &lt;div
                style={{
                  color: "#00000080",
                  padding: "10px",
                  fontSize: "14px",
                  textAlign: "left",
                  marginBottom: "50px",
                  borderBottom: "1px solid lightgrey",
                  width: "93.45%",
                  position: "relative"
                }}
              >
                &lt;LoadingSpinUniCast className="spin-inicio" />
              &lt;/div>
            )}
          &lt;/div>
          &lt;div>
            &lt;div style={{ display: "flex" }}>
              &lt;h5 style={{ fontWeight: "bold" }}>Vídeos recomendados&lt;/h5>
              &lt;div
                className="boton-ver-todos-inicio"
                onClick={() =>
                  this.setState({ displayAll: !this.state.displayAll })
                }
              >
                {this.state.displayAll ? "Ver menos" : "Ver todos"}
              &lt;/div>
            &lt;/div>
            {this.state.displayAll ? (
              &lt;div
                style={{
                  display: "flex",
                  flexWrap: "wrap",
                  marginBottom: "50px",
                  borderBottom: "1px solid lightgrey",
                  overflow: "hidden",
                  width: "93.45%"
                }}
              >
                {this.state.recomendados.length === 0 ? (
                  &lt;div
                    style={{
                      color: "#00000080",
                      padding: "10px",
                      fontSize: "14px",
                      textAlign: "left"
                    }}
                  >
                    Actualmente no tiene recomendaciones, conforme haga uso de
                    la aplicación se le recomendarán vídeos según sus gustos.
                  &lt;/div>
                ) : (
                  Menu(this.state.recomendados, this.state.timeNow)
                )}
              &lt;/div>
            ) : this.state.recomendados.length === 0 ? (
              &lt;div style={{ position: "relative" }}>
                {!this.state.spinRecom ? (
                  &lt;div
                    style={{
                      color: "#00000080",
                      padding: "10px",
                      fontSize: "14px",
                      textAlign: "left",
                      marginBottom: "50px",
                      borderBottom: "1px solid lightgrey",
                      width: "93.45%"
                    }}
                  >
                    Actualmente no tiene recomendaciones, conforme haga uso de
                    la aplicación se le recomendarán vídeos según sus gustos.
                  &lt;/div>
                ) : (
                  &lt;div
                    style={{
                      color: "#00000080",
                      padding: "10px",
                      fontSize: "14px",
                      textAlign: "left",
                      marginBottom: "50px",
                      borderBottom: "1px solid lightgrey",
                      width: "93.45%",
                      position: "relative"
                    }}
                  >
                    &lt;LoadingSpinUniCast className="spin-inicio" />
                  &lt;/div>
                )}
              &lt;/div>
            ) : (
              &lt;ListaHorizontal
                list={this.state.recomendados}
                now={this.state.timeNow}
              />
            )}
          &lt;/div>
          {this.state.asignaturas.map((asig, index) => {
            return (
              &lt;div key={asig.id}>
                &lt;div style={{ marginBottom: ".5rem" }}>
                  &lt;Link
                    to={`/asig/${asig.id}`}
                    style={{
                      fontSize: "1.25rem",
                      color: "black",
                      textDecoration: "none",
                      fontWeight: "bold"
                    }}
                  >
                    &lt;div>
                      &lt;img
                        src={
                          asig.university === undefined
                            ? ""
                            : asig.university.photo
                        }
                        alt={
                          asig.university === undefined
                            ? ""
                            : asig.university.name
                        }
                        width="35"
                        height="35"
                        style={{ borderRadius: "50%" }}
                      />{" "}
                      {asig.name}
                    &lt;/div>
                  &lt;/Link>
                &lt;/div>
                {this.state.videosAsignatura[index] === undefined ? (
                  &lt;div
                    style={{
                      color: "#00000080",
                      padding: "10px",
                      fontSize: "14px",
                      textAlign: "left",
                      marginBottom: "50px",
                      borderBottom: "1px solid lightgrey",
                      width: "93.45%",
                      position: "relative"
                    }}
                  >
                    &lt;LoadingSpinUniCast className="spin-inicio" />
                  &lt;/div>
                ) : this.state.videosAsignatura[index].length === 0 ? (
                  &lt;div
                    style={{
                      color: "#00000080",
                      padding: "10px",
                      fontSize: "14px",
                      textAlign: "left",
                      marginBottom: "50px",
                      borderBottom: "1px solid lightgrey",
                      width: "93.45%"
                    }}
                  >
                    En estos momentos no hay ningún vídeo subido de esta
                    asignatura.
                  &lt;/div>
                ) : (
                  &lt;ListaHorizontal
                    list={this.state.videosAsignatura[index]}
                    now={this.state.timeNow}
                  />
                )}
              &lt;/div>
            );
          })}
        &lt;/div>
      &lt;/div>
    );
  }
}

export default Inicio;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="BarraNavegacion.html">BarraNavegacion</a></li><li><a href="Notificacion.html">Notificacion</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addComment">addComment</a></li><li><a href="global.html#addMessage">addMessage</a></li><li><a href="global.html#addProfessor">addProfessor</a></li><li><a href="global.html#addReproductionList">addReproductionList</a></li><li><a href="global.html#addUser">addUser</a></li><li><a href="global.html#addVideotoReproductionList">addVideotoReproductionList</a></li><li><a href="global.html#addVote">addVote</a></li><li><a href="global.html#authUser">authUser</a></li><li><a href="global.html#borrarAsignatura">borrarAsignatura</a></li><li><a href="global.html#borrarProfeAsignatura">borrarProfeAsignatura</a></li><li><a href="global.html#borrarProfesor">borrarProfesor</a></li><li><a href="global.html#borrarUniversidad">borrarUniversidad</a></li><li><a href="global.html#checkFileExtensionImage">checkFileExtensionImage</a></li><li><a href="global.html#checkFileExtensionVideo">checkFileExtensionVideo</a></li><li><a href="global.html#checkNotification">checkNotification</a></li><li><a href="global.html#crearAsigYLigar">crearAsigYLigar</a></li><li><a href="global.html#crearCarreraYLigar">crearCarreraYLigar</a></li><li><a href="global.html#crearUniversidad">crearUniversidad</a></li><li><a href="global.html#deleteProfessor">deleteProfessor</a></li><li><a href="global.html#deleteReproductionList">deleteReproductionList</a></li><li><a href="global.html#deleteVideo">deleteVideo</a></li><li><a href="global.html#deleteVideoFromDisplay">deleteVideoFromDisplay</a></li><li><a href="global.html#deleteVideoFromReproductionList">deleteVideoFromReproductionList</a></li><li><a href="global.html#diasDelMes">diasDelMes</a></li><li><a href="global.html#emailPattern">emailPattern</a></li><li><a href="global.html#esAyer">esAyer</a></li><li><a href="global.html#esBisiesto">esBisiesto</a></li><li><a href="global.html#f_filterResults">f_filterResults</a></li><li><a href="global.html#f_scrollTop">f_scrollTop</a></li><li><a href="global.html#findSubjectByName">findSubjectByName</a></li><li><a href="global.html#findSubjectsContainingName">findSubjectsContainingName</a></li><li><a href="global.html#findUserProfessors">findUserProfessors</a></li><li><a href="global.html#findVideosContainingTitle">findVideosContainingTitle</a></li><li><a href="global.html#generadorColores">generadorColores</a></li><li><a href="global.html#getCommentsByVideo">getCommentsByVideo</a></li><li><a href="global.html#getDegreeOfUser">getDegreeOfUser</a></li><li><a href="global.html#getDegreesFromUnivesity">getDegreesFromUnivesity</a></li><li><a href="global.html#getDisplaysByUser">getDisplaysByUser</a></li><li><a href="global.html#getLastMessages">getLastMessages</a></li><li><a href="global.html#getMessagesFromSender">getMessagesFromSender</a></li><li><a href="global.html#getMessagesToReceiver">getMessagesToReceiver</a></li><li><a href="global.html#getProfessorsFromSubject">getProfessorsFromSubject</a></li><li><a href="global.html#getRecommendations">getRecommendations</a></li><li><a href="global.html#getReproductionListVideoIn">getReproductionListVideoIn</a></li><li><a href="global.html#getScore">getScore</a></li><li><a href="global.html#getSubjectById">getSubjectById</a></li><li><a href="global.html#getSubjectRanking">getSubjectRanking</a></li><li><a href="global.html#getSubjectsAsProfessor">getSubjectsAsProfessor</a></li><li><a href="global.html#getSubjectsFromUniveristy">getSubjectsFromUniveristy</a></li><li><a href="global.html#getSubjectsOfUser">getSubjectsOfUser</a></li><li><a href="global.html#getTime">getTime</a></li><li><a href="global.html#getTimePassed">getTimePassed</a></li><li><a href="global.html#getUniversityOfUser">getUniversityOfUser</a></li><li><a href="global.html#getUnivesities">getUnivesities</a></li><li><a href="global.html#getUser">getUser</a></li><li><a href="global.html#getUserByUsername">getUserByUsername</a></li><li><a href="global.html#getUserID">getUserID</a></li><li><a href="global.html#getUserNotifications">getUserNotifications</a></li><li><a href="global.html#getUserPhoto">getUserPhoto</a></li><li><a href="global.html#getUserReproductionLists">getUserReproductionLists</a></li><li><a href="global.html#getUserRole">getUserRole</a></li><li><a href="global.html#getUserToken">getUserToken</a></li><li><a href="global.html#getUserUncheckedNotifications">getUserUncheckedNotifications</a></li><li><a href="global.html#getVideo">getVideo</a></li><li><a href="global.html#getVideoDisplay">getVideoDisplay</a></li><li><a href="global.html#getVideosFromReproductionList">getVideosFromReproductionList</a></li><li><a href="global.html#getVideosFromSubject">getVideosFromSubject</a></li><li><a href="global.html#getVideosFromUploader">getVideosFromUploader</a></li><li><a href="global.html#getVideoSubject">getVideoSubject</a></li><li><a href="global.html#hacerProfesor">hacerProfesor</a></li><li><a href="global.html#isSignedIn">isSignedIn</a></li><li><a href="global.html#ligarUniAsig">ligarUniAsig</a></li><li><a href="global.html#ligarUniCarr">ligarUniCarr</a></li><li><a href="global.html#mergeSortedArray">mergeSortedArray</a></li><li><a href="global.html#parsearFecha">parsearFecha</a></li><li><a href="global.html#parseNewMessages">parseNewMessages</a></li><li><a href="global.html#putFavouritesFirst">putFavouritesFirst</a></li><li><a href="global.html#RemoveAccents">RemoveAccents</a></li><li><a href="global.html#restriccion">restriccion</a></li><li><a href="global.html#restriccionNombre">restriccionNombre</a></li><li><a href="global.html#restriccionUser">restriccionUser</a></li><li><a href="global.html#scrollFunc">scrollFunc</a></li><li><a href="global.html#setUserPhoto">setUserPhoto</a></li><li><a href="global.html#setUserRole">setUserRole</a></li><li><a href="global.html#signIn">signIn</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#SubscribeSubject">SubscribeSubject</a></li><li><a href="global.html#UnsubscribeSubject">UnsubscribeSubject</a></li><li><a href="global.html#updateDisplay">updateDisplay</a></li><li><a href="global.html#updateUser">updateUser</a></li><li><a href="global.html#UploadVideo">UploadVideo</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Tue May 28 2019 18:26:06 GMT+0200 (hora de verano de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
